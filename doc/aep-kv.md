
# <center>基于可持久化内存-AEP的KV存储引擎</center>
> 一份简单的AEP上手指南

# 我们做的是个啥？

可持久化内存-PMem在 2018 年的时候还仅限于学术界的探讨，而如今已经来到了工业界。Intel 在 2019 年 4 月份发布了第一款 全英特尔® 傲腾™ 数据中心级持久内存-Intel Optane DC Persistent Memory 重新定义了传统的架构在内存密集型工作模式，具有突破性的性能水平，同时具有持久化能力。而近几年的学术界中，关于持久化内存的应用已经成为一个研究热点。PMEM目前的一种常用配置是将DRAM运行为CPU的缓存，使用单位容量价格较低的PMEM作为主存，这种方式可以使现有应用程序无痛迁移到PMEM上，且不会相比DRAM有太大的性能差异。但是想要充分利用PMEM的性能，最佳方案仍然是设计专业的应用程序。因而，**本项目拟基于可持久化内存实现一个高效的可持久化的KV存储引擎，以探索可持久化内存在工业领域的实践落地**。

# 我们为啥要做这个？

- 该硬件据说很厉害，恰好我们有一些在仓库里吃灰。
- 结合最近几年的学术界情况，关于aep的研究比较火。
- 我们想验证一下是不是真的这么强。

# 我们都做了啥？

结合可持久化内存-AEP自身的特性，实现一个的KV存储引擎，目前主要包括一下几点实现：
1. 结合AEP的特性设计了KV的数据结构。
2. 结合AEP的特性，实现高效的多线程写入、读取、更新，确保单条写入请求的正确性以及原子性。
3. 数据具有持久化和可恢复的能力，确保在接口调用后，即使掉电的时候依然能保证数据的完整性和正确恢复。
4. 实现一个针对AEP的内存GC管理器。

# 我们是怎么做的？
## AEP简述
### 什么是AEP？
持久化内存（Persistent Memory，简称 PMEM），也叫非易失性内存（Non-Volatile Memory，简称 NVM），是指一类支持字节寻址（byte-addressable）、可以通过 CPU 指令直接进行操作、断电后数据不丢失的存储硬件。
### AEP的两种使用模式
Optane DIMM 有两种工作模式：Memory Mode 和 App Direct Mode。

- Memory Mode 简单说就是把 Optane DIMMs 当成易失性内存使用，把 DRAM 当作 CPU 和 Optane DIMMs 之间的 cache，并且 DRAM 对外不可见（就像 CPU 的多级 cache 对外也不可见）。基于 Memory Mode 的工作模式，可以通过应用无感知的方式，解决一些内存数据库（比如 Redis、Memcached）单机 DRAM 容量不足或成本过高的问题。
- App Direct Mode 将 Optane DIMMs 当成一个持久化设备来使用，直接通过 CPU 指令读写 Optane DIMMs，不需要经过 DRAM。应用可以使用能够感知持久化内存的文件系统（比如 EXT4-DAX、XFS-DAX、NOVA）或其他组件（比如 PMDK）来管理、操作持久化内存设备。
  
显而易见**本项目中使用的是App Direct Mode**，即将aep挂载到文件系统中使用。

### AEP的

## 整体架构
## 数据结构
## 断电恢复
## GC设计
## AEP使用心得总结
## Reference

# 效果如何？

# Quickly Start


